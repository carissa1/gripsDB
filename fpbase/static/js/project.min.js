function reset_ipgid(e){e&&$("#hint_id_ipg_id").html(e),$("#id_seq").prop("disabled",!1),$("#hint_id_seq").html("Amino acid sequence (IPG ID is preferred)")}function chunkString(e,i){for(var t,n=Math.ceil(e.length/i),s=new Array(n),r=0;r<n;r++)t=r*i,s[r]=e.substring(t,t+i);return s}function format_protein(e,i){i=i||10,e.find(".sequence_count").empty(),words=chunkString(e.text().replace(/ /g,""),i),e.empty(),seqcount=$("<div class='sequence_count'></div>").appendTo(e),seqdiv=$("<div class='formatted_aminosquence'></div>").appendTo(e),seqdiv.text(words[0]),seqcount.append("1<br>");for(var t=seqdiv.height(),n=1;n<words.length;n++)seqdiv.text(seqdiv.text()+" "+words[n]),seqdiv.height()>t&&(seqcount.append(n*i+1+"<br>"),t=seqdiv.height());e.show()}$(".form-group").removeClass("row"),$(".dark_state_button input").click(function(){neighbors=$(this).closest(".stateform_block").children(".hide_if_dark"),$(this)[0].checked?(neighbors.hide(),$(this).find("input[name*='max']").empty()):(neighbors.show(),$(this).closest(".stateform_block"))}),$(function(){$(".dark_state_button input:checked").each(function(){neighbors=$(this).closest(".stateform_block").children(".hide_if_dark"),neighbors.hide()})}),$("#id_ipg_id").change(function(){ipg_id=$(this).val(),protein_uri="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=protein&retmode=json&rettype=fasta&id=",ipg_uri="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=ipg&retmode=json&id=",fpbase_params="&tool=fpbase&email=talley.lambert+fpbase@gmail.com",$.ajax({url:ipg_uri+ipg_id+fpbase_params,context:document.body,success:function(e){if("result"in e){if(ipg_id in e.result){var i=e.result[ipg_id].accession;title=e.result[ipg_id].title,$("#hint_id_ipg_id").html("IPG name: "+title),$.ajax({url:protein_uri+i+fpbase_params,context:document.body,success:function(e){for(var i=e.split("\n"),t="",n=0;n<i.length;n++)0!=i[n].length&&">"!=i[n][0]&&(t+=i[n]);$("#id_seq").val(t),$("#id_seq").prop("disabled",!0),$("#hint_id_seq").html("Sequence input disabled when IPG ID provided")},error:function(e){reset_ipgid("Unrecognized IPG ID")}})}}else reset_ipgid('NCBI <a href="https://www.ncbi.nlm.nih.gov/ipg/docs/about/">Identical Protein Group ID</a>')},error:function(e){reset_ipgid("Unrecognized IPG ID")}})}),$("#id_reference_doi").change(function(){doi=$(this).val(),searchurl="https://api.crossref.org/v1/works/",searchurl+=doi,$.ajax({url:searchurl,context:document.body,success:function(e){"ok"==e.status?(year=e.message.issued["date-parts"][0][0],author=e.message.author[0].family,title=e.message.title[0].slice(0,45),citation=author+" ("+year+") "+title+"...",$("#hint_id_reference_doi").html(citation)):$("#hint_id_reference_doi").html("DOI not found at Crossref")},error:function(e){$("#hint_id_reference_doi").html("DOI not found at Crossref")}})}),$(function(){$(".aminosequence").each(function(){format_protein($(this))})}),$(window).resize(function(){$(".aminosequence").each(function(){format_protein($(this))})});