function chunkString(e,t){for(var i,n=Math.ceil(e.length/t),o=new Array(n),s=0;s<n;s++)i=s*t,o[s]=e.substring(i,i+t);return o}function format_protein(e,t){t=t||10,e.find(".sequence_count").empty(),words=chunkString(e.text().replace(/ /g,""),t),e.empty(),seqcount=$("<div class='sequence_count'></div>").appendTo(e),seqdiv=$("<div class='formatted_aminosquence'></div>").appendTo(e),seqdiv.text(words[0]),seqcount.append("1<br>");for(var i=seqdiv.height(),n=1;n<words.length;n++)seqdiv.text(seqdiv.text()+" "+words[n]),seqdiv.height()>i&&(seqcount.append(n*t+1+"<br>"),i=seqdiv.height(),console.log("height: "+i,"length: ",seqdiv.text().length));e.show()}$(".form-group").removeClass("row"),$(".dark_state_button input").click(function(){neighbors=$(this).closest(".stateform_block").children(".hide_if_dark"),$(this)[0].checked?neighbors.hide():neighbors.show()}),$("#id_ipg_id").change(function(){ipg_id=$(this).val(),protein_uri="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=protein&retmode=json&rettype=fasta&id=",ipg_uri="https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=ipg&retmode=json&id=",fpbase_params="&tool=fpbase&email=talley.lambert+fpbase@gmail.com",$.ajax({url:ipg_uri+ipg_id+fpbase_params,context:document.body,success:function(e){if(ipg_id in e.result){var t=e.result[ipg_id].accession;title=e.result[ipg_id].title,$("#hint_id_ipg_id").html(title),$.ajax({url:protein_uri+t+fpbase_params,context:document.body,success:function(e){for(var t=e.split("\n"),i="",n=0;n<t.length;n++)0!=t[n].length&&">"!=t[n][0]&&(i+=t[n]);$("#id_seq").val(i)}})}},error:function(e){$("#hint_id_ipg_id").html("Protein ID not found in the NCBI IPG database")}})}),$("#id_reference_doi").change(function(){doi=$(this).val(),searchurl="https://api.crossref.org/v1/works/",searchurl+=doi,$.ajax({url:searchurl,context:document.body,success:function(e){"ok"==e.status?(year=e.message.issued["date-parts"][0][0],author=e.message.author[0].family,title=e.message.title[0].slice(0,45),citation=author+" ("+year+") "+title+"...",$("#hint_id_reference_doi").html(citation)):$("#hint_id_reference_doi").html("DOI not found at Crossref")},error:function(e){$("#hint_id_reference_doi").html("DOI not found at Crossref")}})}),$(function(){$(".aminosequence").each(function(){format_protein($(this))})}),$(window).resize(function(){$(".aminosequence").each(function(){format_protein($(this))})});